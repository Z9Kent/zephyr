/*
 * Copyright (c) Z9 Security
 */

/dts-v1/;
#include <atmel/saml22.dtsi>
#include "wl_athena-pinctrl.dtsi"
#include <zephyr/dt-bindings/input/input-event-codes.h>
#include <dt-bindings/pinctrl/saml22g-pinctrl.h>

/ {
	model = "Wavelynx Athena Lock Controller";
	//compatible = "atsaml22,xpro", "atmel,saml22g17a", "atmel,saml22";
	compatible = "atmel,saml22g17a", "atmel,saml22";

	chosen {
		zephyr,sram = &sram0;
		zephyr,flash = &flash0;
	};

	/* These aliases are provided for compatibility with samples */
	aliases {
		red = &red;
		green = &green;
		blue = &blue;
		
		sw0 = &user_button;
		z9io-serial = &sercom3;
	};

	leds {
		compatible = "gpio-leds";
		red: red_led0 { 
			gpios = <&porta 4 GPIO_ACTIVE_LOW>;
			label = "Red LED";
		};
		green: green_led0 { 
			gpios = <&porta 5 GPIO_ACTIVE_LOW>;
			label = "Green LED";
		};
		blue: blue_led0 { 
			gpios = <&porta 6 GPIO_ACTIVE_LOW>;
			label = "Blue LED";
		};
	};

	buttons {
		compatible = "gpio-keys";
		user_button: button_0 {
			gpios = <&porta 25 (GPIO_PULL_UP | GPIO_ACTIVE_LOW)>;
			label = "SW0";
			zephyr,code = <INPUT_KEY_0>;
		};
	};

	vcc_aux  {
		compatible = "regulator-fixed";
		regulator-name = "VCC_AUX";
		enable-gpios = <&porta 24 GPIO_ACTIVE_LOW>;
		regulator-boot-on;
	};


};

&sercom3 {
    current-speed = <9600>;
    status = "okay";
};

&cpu0 {
	clock-frequency = <48000000>;
};

&adc {
	status = "disabled";
};

&tcc0 {
	status = "disabled";
	compatible = "atmel,sam0-tcc-pwm";
	/* Gives a maximum period of 1.4s */
	prescaler = <4>;
	#pwm-cells = <2>;

	//pinctrl-0 = <&tcc0_default>;
	//pinctrl-names = "default";
};

&sercom0 {
	status = "okay";
	compatible = "atmel,sam0-spi";
	dipo = <2>;
	dopo = <0>;
	#address-cells = <1>;
	#size-cells = <0>;

	cs-gpios = <&porta 23 GPIO_ACTIVE_LOW>;

	pinctrl-0 = <&sercom0_default>;
	pinctrl-names = "default";
};

/*
&sercom2 {
	status = "okay";
	compatible = "atmel,sam0-spi";
	dipo = <0>;
	dopo = <1>;
	#address-cells = <1>;
	#size-cells = <0>;

	cs-gpios = <&porta 23 GPIO_ACTIVE_LOW>;

	pinctrl-0 = <&sercom2_default>;
	pinctrl-names = "default";
};
*/
&sercom3 {
	status = "okay";
	compatible = "atmel,sam0-uart";
	current-speed = <9600>;
	rxpo = <1>;
	txpo = <0>;

	pinctrl-0 = <&sercom3_default>;
	pinctrl-names = "default";
};

&sercom0 {
	mx25l3233f: mx25l3233f@0 {
			compatible = "jedec,spi-nor";
			reg = <0>;
			spi-max-frequency = <8000000>;
			jedec-id = [c2 20 16];
/* 			sfdp-bfp = [e5 20 f1 ff ff ff ff 03 44 eb 08 6b
						08 3b 04 bb ee ff ff ff ff ff 00 ff
						ff ff 00 ff 0c 20 0f 52 10 d8 00 ff
						23 72 f5 00 82 ed 04 cc 44 83 68 44
						30 b0 30 b0 f7 c4 d5 5c 00 be 29 ff
						f0 d0 ff ff];
*/
			size = <33554432>;
			supply-gpios = <&porta 24 GPIO_ACTIVE_LOW>;
			has-dpd;
			t-enter-dpd = <10000>;
			t-exit-dpd = <100000>;
	};
};

&mx25l3233f {

	partitions {
		compatible = "fixed-partitions";
		#address-cells = <1>;
		#size-cells = <1>;

        storage_partition: partition@20000 {
                label = "storage";
                reg = <0x00020000 0x00008000>;
        };
		event_normal_partition: partition@28000 {
			label = "event-normal";
			reg = <0x00028000 0x0008000>;
		};
		event_priority_partition: partition@30000 {
			label = "event-priority";
			reg = <0x00030000 0x0008000>;
		};
		credentials: partition@38000 {
			label = "credentials";
			reg = <0x00038000 0x0008000>;
		};
    };
};


&trng {
	status = "okay";
};
